@echo off
chcp 65001 > nul
cls

echo ========================================
echo    AIWife ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
echo ========================================
echo.

REM Docker DesktopãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
echo [1/4] Docker Desktopã®çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã„ã¾ã™...
docker info >nul 2>&1
if %ERRORLEVEL% NEQ 0 (
    echo.
    echo âŒ DockerãŒèµ·å‹•ã—ã¦ã„ã¾ã›ã‚“
    echo.
    echo ðŸ“Œ ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
    echo    1. Docker Desktopã‚’èµ·å‹•ã—ã¦ãã ã•ã„
    echo    2. Docker DesktopãŒå®Œå…¨ã«èµ·å‹•ã™ã‚‹ã¾ã§å¾…ã¡ã¾ã™ï¼ˆ1-2åˆ†ï¼‰
    echo    3. å†åº¦ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
    echo.
    pause
    exit /b 1
)
echo âœ“ DockerãŒèµ·å‹•ã—ã¦ã„ã¾ã™
echo.

REM .envãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
echo [2/4] ç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ã„ã¾ã™...
if not exist ".env" (
    echo.
    echo âŒ .envãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
    echo.
    echo ðŸ“Œ .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„
    echo    è©³ã—ãã¯ DOCKER_SETUP_GUIDE.md ã‚’å‚ç…§ã—ã¦ãã ã•ã„
    echo.
    pause
    exit /b 1
)
echo âœ“ .envãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ã¾ã™
echo.

REM æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ãƒ»å‰Šé™¤
echo [3/4] æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã—ã¦ã„ã¾ã™...
docker-compose down >nul 2>&1
echo âœ“ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†
echo.

REM Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’ãƒ“ãƒ«ãƒ‰ï¼†èµ·å‹•
echo [4/4] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™...
echo    â€»åˆå›žèµ·å‹•æ™‚ã¯æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
echo.
docker-compose up --build -d

if %ERRORLEVEL% NEQ 0 (
    echo.
    echo âŒ èµ·å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ
    echo.
    echo ðŸ“Œ è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã«ã¯ï¼š
    echo    docker-compose logs
    echo.
    pause
    exit /b 1
)

echo.
echo ========================================
echo    ðŸŽ‰ èµ·å‹•å®Œäº†ï¼
echo ========================================
echo.
echo ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: http://localhost:3000
echo ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰:   http://localhost:5000
echo.
echo ãƒ–ãƒ©ã‚¦ã‚¶ãŒè‡ªå‹•çš„ã«é–‹ã‹ãªã„å ´åˆã¯ã€
echo ä¸Šè¨˜URLã‚’æ‰‹å‹•ã§é–‹ã„ã¦ãã ã•ã„ã€‚
echo.
echo ðŸ“Œ åœæ­¢ã™ã‚‹ã«ã¯ã€Œstop.batã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„
echo ========================================
echo.

REM æ•°ç§’å¾…ã£ã¦ã‹ã‚‰ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ã
timeout /t 5 /nobreak >nul
start http://localhost:3000

pause
